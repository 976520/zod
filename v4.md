# Zod 4

## Early adopters

- Speakeasy
- CodeRabbit

## New features

- Adds top-level functions for string formats
  - Simpler syntax, more treeshakable
  - `z.email()`, `z.uuidv4()`, etc
- Adds new string formats
  - `z.e164`
  - `z.base64`
  - `z.jwt`
  - `z.ascii`
  - `z.utf8`
  - `z.lowercase`
  - `z.iso.date`
  - `z.iso.datetime`
  - `z.iso.duration`
  - `z.iso.time`
- `z.file()`
  - `.min()`
  - `.max()`
  - `.type()`
- Add new number formats
  - `z.int()`
  - `z.float32()`
  - `z.float64()`
  - `z.int32()`
  - `z.uint32()`
- Add new bigint formats
  - `z.int64`
  - `z.uint64`
- Add `z.interface()`
  - Fixes `exactOptionalPropertyTypes`
  - Supports recursive objects
  - Lightweight types: easier on the compiler
  - Less characters than `.optional()`
  - No methods: `.passthrough()`, `.strict()`, `.nonstrict()`
  - No `.merge()`: use `.extend()`
  - Drops `.shape`
- Simplifies error customization
  - Unifies `message` and `errorMap` into `error`
  - Access `issue.input` directly
- Adds `z.looseObject` and `z.strictObject`
- Supports multiple values in `z.literal()`
- Adds `z.success()`
- Adds `z.stringbool()`
- Add `z.overwrite()`
- Add `z.transform()`
- Optionals in ZodTuple
- Registries and metadata
  - `.meta()` and `GlobalMeta`
  - `z.globalRegistry`
  - `z.registry()`
  - `z.jsonSchemaRegistry()`
- `z.templateLiteral()`
- `reportInput`

## Breaking changes

- New issue formats
- New generics
- Drop static `.create()` methods
- Drops `z.promise()`
- ZodFunction
  - not a schema, it's a standalone utility class
  - new API: `z.function({input, output})`
- Drops `ZodTransform`
  - Refinements are now stored inside schemas
  - Transform and preprocess are now `ZodTransform`
  - Drops `ctx.addIssue` inside `z.preprocess()`
- Drops `z.nativeEnum`, just use `z.enum`
- Drops `required_error` and `invalid_type_error`
  - Unified `error` field
- Drops methods on `ZodError`: `.format()`, `.flatten()`, `.formErrors()`, `.fieldErrors()`, etc.
  - These are now top-level functions
- Drops `ZodObject` `.nonstrict()`
- `POSITIIVE_INFINITY` and `NEGATIVE_INFINITY` are no longer valid values for z.number
- `z.number().int()` no longer accepts unsafe integers
- Refinements are internal
- ZodObject `.keyof()` now returns `ZodLiteral` not `ZodEnum`
- No need to specify discriminator in `z.discriminatedUnion`
- No more (val: Output)=>string as second argument to `.refine()`. Use error map.
- "Hard-coded" error map now takes precedence over contextual error map
- No question mark for `unknown`/`any` schemas
- No support for `null` or `undefined` in `z.literal`
  - `z.literal(null)`
  - `z.literal(undefined)`
  - this was never documented
- `ZodArray.nonempty()` does not change inferred type
- Array min/max/length checks now run after parsing. This means they won't run if the parse has already aborted.
- Defs have been re-designed
  - Renamed `typeName` -> `type`
- Drops single-argument `z.record()`
- Intersection merge errors are now thrown as Error not ZodError
  - These usually do not reflect a parse error but a structural problem with the schema
- Consolidates `unknownKeys` and `catchall` in ZodObject
- Dropping
  - `ZodBranded`: purely a static-domain annotation
  - `ZodFunction`
- The `description` is now stored in `z.defaultRegistry`, not the def
  - No support for `description` in factory params
  - Descriptions do not cascade in `.optional()`, etc
- Enums:
  - ZodEnum and ZodNativeEnum are merged
  - `.Values` and `.Enum` are removed. Use `.enum` instead.
  - `.options` is removed
