# Zod 4

## New features

- Adds top-level functions for string formats
  - `z.email()`, `z.uuidv4()`, etc
- Adds new string formats
  - `z.e164`
  - `z.base64`
  - `z.jwt`
  - `z.ascii`
  - `z.utf8`
  - `z.lowercase`
- Add new number formats
  - `z.int()`
  - `z.float32`
  - `z.float64`
  - `z.int32`
  - `z.uint32`
- Add new bigint formats
  - `z.int64`
  - `z.uint64`
- Add `z.interface()`
  - Fixes `exactOptionalPropertyTypes`
  - Supports recursive objects
  - Lightweight types: easier on the compiler
  - Less characters than `.optional()`
  - No methods: `.passthrough()`, `.strict()`, `.nonstrict()`
  - No `.merge()`: use `.extend()`
  - Drops `.shape`
- Simplifies error customization
  - Unifies `message` and `errorMap` into `error`
  - Access `issue.input`
- Adds `z.looseObject` and `z.strictObject`
- Supports multiple values in `z.literal()`
- Adds `z.success()`
- Adds `z.stringbool()`
- Add `z.overwrite()`
- Add `z.transform()`
- Optionals in ZodTuple
- Metadata
  - `z.globalRegistry`
- Collections
  - `z.registry()`
  - `z.namedRegistry()`
- `z.templateLiteral()`

## Breaking changes

- New issue formats
- New error map format
- New generics
- Drops `ZodEffects`
  - Refinements are now stored inside schemas
  - Transform and preprocess are now `ZodEffect`
  - Drops `ctx.addIssue` inside `z.preprocess()`
- Drops `z.nativeEnum`, just use `z.enum`
- Drops `required_error` and `invalid_type_error`
  - Unified `error` field
- Drops methods on `ZodError`: `.format()`, `.flatten()`, `.formErrors()`, `.fieldErrors()`, etc.
  - These are now top-level functions
- Drops `ZodObject` `.nonstrict()`
- `POSITIIVE_INFINITY` and `NEGATIVE_INFINITY` are no longer valid values for z.number
- `z.number().int()` no longer accepts unsafe integers
- Refinements are internal
- ZodObject `.keyof()` now returns `ZodLiteral` not `ZodEnum`
- No need to specify discriminator in `z.discriminatedUnion`
- No more (val: Output)=>string as second argument to `.refine()`. Use error map.
- Drop `ZodPreprocess`, `ZodTransform`
  - Same result is achieved with `z.effect()` and `z.pipeline()`.
  - `z.preprocess` is deprecated
- No question mark for unknown/any schemas
- No support for `null` or `undefined` in `z.literal`
  - `z.literal(null)`
  - `z.literal(undefined)`
  - this was never documented
- Defs have been re-designed
  - Renamed `typeName` -> `type`
- Drops single-argument `z.record()`
- Intersection merge errors are now thrown as Error not ZodError
  - These usually do not reflect a parse error but a structural problem with the schema
- Consolidates `unknownKeys` and `catchall` in ZodObject
- Dropping
  - `ZodBranded`: purely a static-domain annotation
  - `ZodFunction`
